<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯è§†åŒ–é¡µé¢æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 20px;
            background: #f8f9fa;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        
        .btn:hover { opacity: 0.8; }
        
        .status-display {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
            background: #e9ecef;
            font-family: monospace;
            font-size: 12px;
        }
        
        iframe {
            width: 100%;
            height: 800px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª å¯è§†åŒ–é¡µé¢é‡æ„æµ‹è¯•</h1>
            <p>æµ‹è¯•æ–°çš„æ¨¡å—åŒ–æ¶æ„åœ¨å¯è§†åŒ–é¡µé¢ä¸­çš„é›†æˆæ•ˆæœ</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•</h3>
            <div id="checklist">
                <div class="check-item">
                    <input type="checkbox" id="check1"> 
                    <label for="check1">é¡µé¢æ­£å¸¸åŠ è½½ï¼Œæ— JavaScripté”™è¯¯</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check2"> 
                    <label for="check2">ä¾§è¾¹æ å¯¼èˆªæ­£å¸¸å·¥ä½œ</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check3"> 
                    <label for="check3">æ–‡ä»¶é€‰æ‹©å™¨ç»„ä»¶æ­£å¸¸æ˜¾ç¤º</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check4"> 
                    <label for="check4">æ•°æ®ç­›é€‰å™¨ç»„ä»¶æ­£å¸¸æ˜¾ç¤º</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check5"> 
                    <label for="check5">å›¾è¡¨é…ç½®ç»„ä»¶æ­£å¸¸æ˜¾ç¤º</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check6"> 
                    <label for="check6">å›¾è¡¨å·¥å…·æ åŠŸèƒ½æ­£å¸¸</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check7"> 
                    <label for="check7">å“åº”å¼å¸ƒå±€æ­£å¸¸å·¥ä½œ</label>
                </div>
                <div class="check-item">
                    <input type="checkbox" id="check8"> 
                    <label for="check8">çŠ¶æ€ç®¡ç†å’Œäº‹ä»¶ç³»ç»Ÿæ­£å¸¸</label>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="loadNewPage()">åŠ è½½æ–°ç‰ˆé¡µé¢</button>
                <button class="btn btn-secondary" onclick="loadOriginalPage()">åŠ è½½åŸç‰ˆé¡µé¢</button>
                <button class="btn btn-success" onclick="runAutoTest()">è‡ªåŠ¨æµ‹è¯•</button>
                <button class="btn btn-warning" onclick="checkConsole()">æ£€æŸ¥æ§åˆ¶å°</button>
                <button class="btn btn-danger" onclick="clearTest()">æ¸…é™¤æµ‹è¯•</button>
            </div>
            
            <div class="status-display" id="status-display">
                çŠ¶æ€: ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š é¡µé¢é¢„è§ˆ</h3>
            <iframe id="test-frame" src="about:blank"></iframe>
        </div>

        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•ç»“æœ</h3>
            <div id="test-results">
                <p>æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>
    </div>

    <script>
        let testFrame = null;
        let testResults = [];

        function updateStatus(message) {
            const statusDisplay = document.getElementById('status-display');
            const timestamp = new Date().toLocaleTimeString();
            statusDisplay.innerHTML += `[${timestamp}] ${message}\n`;
            statusDisplay.scrollTop = statusDisplay.scrollHeight;
        }

        function loadNewPage() {
            testFrame = document.getElementById('test-frame');
            testFrame.src = 'visualization-new.html';
            updateStatus('æ­£åœ¨åŠ è½½æ–°ç‰ˆå¯è§†åŒ–é¡µé¢...');
            
            testFrame.onload = function() {
                updateStatus('âœ… æ–°ç‰ˆé¡µé¢åŠ è½½å®Œæˆ');
                setTimeout(checkPageLoad, 1000);
            };
            
            testFrame.onerror = function() {
                updateStatus('âŒ æ–°ç‰ˆé¡µé¢åŠ è½½å¤±è´¥');
            };
        }

        function loadOriginalPage() {
            testFrame = document.getElementById('test-frame');
            testFrame.src = 'visualization.html';
            updateStatus('æ­£åœ¨åŠ è½½åŸç‰ˆå¯è§†åŒ–é¡µé¢...');
            
            testFrame.onload = function() {
                updateStatus('âœ… åŸç‰ˆé¡µé¢åŠ è½½å®Œæˆ');
            };
            
            testFrame.onerror = function() {
                updateStatus('âŒ åŸç‰ˆé¡µé¢åŠ è½½å¤±è´¥');
            };
        }

        function checkPageLoad() {
            try {
                const frameDoc = testFrame.contentDocument || testFrame.contentWindow.document;
                
                // æ£€æŸ¥åŸºæœ¬å…ƒç´ 
                const checks = [
                    { id: 'sidebar', name: 'ä¾§è¾¹æ ' },
                    { id: 'file-selector-container', name: 'æ–‡ä»¶é€‰æ‹©å™¨å®¹å™¨' },
                    { id: 'data-filter-container', name: 'æ•°æ®ç­›é€‰å™¨å®¹å™¨' },
                    { id: 'chart-config-container', name: 'å›¾è¡¨é…ç½®å®¹å™¨' },
                    { id: 'chart-container', name: 'å›¾è¡¨å®¹å™¨' }
                ];

                let passedChecks = 0;
                checks.forEach(check => {
                    const element = frameDoc.getElementById(check.id);
                    if (element) {
                        updateStatus(`âœ… ${check.name} å­˜åœ¨`);
                        passedChecks++;
                    } else {
                        updateStatus(`âŒ ${check.name} ä¸å­˜åœ¨`);
                    }
                });

                // æ£€æŸ¥JavaScriptå¯¹è±¡
                const frameWindow = testFrame.contentWindow;
                const jsChecks = [
                    { obj: 'window.appState', name: 'AppState' },
                    { obj: 'window.dataManager', name: 'DataManager' },
                    { obj: 'window.chartEngine', name: 'ChartEngine' },
                    { obj: 'window.eventBus', name: 'EventBus' }
                ];

                jsChecks.forEach(check => {
                    try {
                        const obj = eval(`frameWindow.${check.obj}`);
                        if (obj) {
                            updateStatus(`âœ… ${check.name} å·²åŠ è½½`);
                            passedChecks++;
                        } else {
                            updateStatus(`âŒ ${check.name} æœªåŠ è½½`);
                        }
                    } catch (error) {
                        updateStatus(`âŒ ${check.name} æ£€æŸ¥å¤±è´¥: ${error.message}`);
                    }
                });

                const totalChecks = checks.length + jsChecks.length;
                const successRate = Math.round((passedChecks / totalChecks) * 100);
                updateStatus(`ğŸ“Š æ£€æŸ¥å®Œæˆ: ${passedChecks}/${totalChecks} (${successRate}%)`);

            } catch (error) {
                updateStatus(`âŒ é¡µé¢æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        function runAutoTest() {
            updateStatus('ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            
            // æ¸…é™¤ä¹‹å‰çš„ç»“æœ
            testResults = [];
            
            // åŠ è½½æ–°é¡µé¢å¹¶è¿è¡Œæµ‹è¯•
            loadNewPage();
            
            setTimeout(() => {
                runComponentTests();
            }, 3000);
        }

        function runComponentTests() {
            updateStatus('ğŸ§ª å¼€å§‹ç»„ä»¶åŠŸèƒ½æµ‹è¯•...');
            
            try {
                const frameWindow = testFrame.contentWindow;
                
                // æµ‹è¯•æ–‡ä»¶é€‰æ‹©å™¨
                if (frameWindow.fileSelector) {
                    updateStatus('âœ… FileSelector ç»„ä»¶å¯è®¿é—®');
                    testResults.push({ component: 'FileSelector', status: 'pass' });
                } else {
                    updateStatus('âŒ FileSelector ç»„ä»¶ä¸å¯è®¿é—®');
                    testResults.push({ component: 'FileSelector', status: 'fail' });
                }
                
                // æµ‹è¯•æ•°æ®ç­›é€‰å™¨
                if (frameWindow.dataFilter) {
                    updateStatus('âœ… DataFilter ç»„ä»¶å¯è®¿é—®');
                    testResults.push({ component: 'DataFilter', status: 'pass' });
                } else {
                    updateStatus('âŒ DataFilter ç»„ä»¶ä¸å¯è®¿é—®');
                    testResults.push({ component: 'DataFilter', status: 'fail' });
                }
                
                // æµ‹è¯•å›¾è¡¨é…ç½®
                if (frameWindow.chartConfig) {
                    updateStatus('âœ… ChartConfig ç»„ä»¶å¯è®¿é—®');
                    testResults.push({ component: 'ChartConfig', status: 'pass' });
                } else {
                    updateStatus('âŒ ChartConfig ç»„ä»¶ä¸å¯è®¿é—®');
                    testResults.push({ component: 'ChartConfig', status: 'fail' });
                }
                
                // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
                displayTestResults();
                
            } catch (error) {
                updateStatus(`âŒ ç»„ä»¶æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        function displayTestResults() {
            const resultsDiv = document.getElementById('test-results');
            let html = '<h4>ğŸ¯ æµ‹è¯•ç»“æœæ±‡æ€»</h4>';
            
            const passCount = testResults.filter(r => r.status === 'pass').length;
            const totalCount = testResults.length;
            const successRate = Math.round((passCount / totalCount) * 100);
            
            html += `<p><strong>æ€»ä½“æˆåŠŸç‡: ${successRate}% (${passCount}/${totalCount})</strong></p>`;
            html += '<ul>';
            
            testResults.forEach(result => {
                const icon = result.status === 'pass' ? 'âœ…' : 'âŒ';
                const status = result.status === 'pass' ? 'é€šè¿‡' : 'å¤±è´¥';
                html += `<li>${icon} ${result.component}: ${status}</li>`;
            });
            
            html += '</ul>';
            
            if (successRate >= 80) {
                html += '<p style="color: green;"><strong>ğŸ‰ æµ‹è¯•é€šè¿‡ï¼æ–°ç‰ˆé¡µé¢é›†æˆæˆåŠŸã€‚</strong></p>';
            } else if (successRate >= 60) {
                html += '<p style="color: orange;"><strong>âš ï¸ éƒ¨åˆ†æµ‹è¯•é€šè¿‡ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</strong></p>';
            } else {
                html += '<p style="color: red;"><strong>âŒ æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦ä¿®å¤é—®é¢˜ã€‚</strong></p>';
            }
            
            resultsDiv.innerHTML = html;
        }

        function checkConsole() {
            updateStatus('ğŸ” æ£€æŸ¥æ§åˆ¶å°é”™è¯¯...');
            
            try {
                const frameWindow = testFrame.contentWindow;
                
                // é‡å†™console.erroræ¥æ•è·é”™è¯¯
                const originalError = frameWindow.console.error;
                let errorCount = 0;
                
                frameWindow.console.error = function(...args) {
                    errorCount++;
                    updateStatus(`âŒ æ§åˆ¶å°é”™è¯¯ ${errorCount}: ${args.join(' ')}`);
                    originalError.apply(frameWindow.console, args);
                };
                
                setTimeout(() => {
                    if (errorCount === 0) {
                        updateStatus('âœ… æ²¡æœ‰å‘ç°æ§åˆ¶å°é”™è¯¯');
                    } else {
                        updateStatus(`âš ï¸ å‘ç° ${errorCount} ä¸ªæ§åˆ¶å°é”™è¯¯`);
                    }
                }, 2000);
                
            } catch (error) {
                updateStatus(`âŒ æ§åˆ¶å°æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        function clearTest() {
            const statusDisplay = document.getElementById('status-display');
            statusDisplay.innerHTML = 'çŠ¶æ€: æµ‹è¯•å·²æ¸…é™¤...\n';
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>';
            
            testResults = [];
            
            // æ¸…é™¤æ‰€æœ‰å¤é€‰æ¡†
            const checkboxes = document.querySelectorAll('#checklist input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            
            updateStatus('ğŸ§¹ æµ‹è¯•ç¯å¢ƒå·²æ¸…ç†');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('ğŸ“‹ æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
            updateStatus('ğŸ’¡ æç¤º: ç‚¹å‡»"åŠ è½½æ–°ç‰ˆé¡µé¢"å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>